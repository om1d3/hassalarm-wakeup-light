# Hassalarm wake-up light integration
# dashboard Card examples
#
# add these to your Lovelace dashboard
# edit Dashboard ‚Üí Add Card ‚Üí Manual (YAML)

# ========================================
# MAIN CONTROL CARD
# toggle button with status indicators
# requires: button-card from HACS
# ========================================
type: custom:button-card
entity: input_boolean.alarm_light_enabled
name: |
  [[[
    return entity.state === 'on' ? 'Alarm Light is ON' : 'Alarm Light is OFF';
  ]]]
icon: mdi:alarm-light
show_state: false
show_label: true
label: |
  [[[
    if (states['input_datetime.next_alarm']) {
      return 'Next: ' + states['input_datetime.next_alarm'].state;
    }
    return 'No alarm set';
  ]]]
tap_action:
  action: toggle
styles:
  icon:
    - width: 35px
    - color: |
        [[[ 
          var phone = states['device_tracker.your_phone'];  // CHANGE THIS
          var phoneHome = phone && phone.state === 'home';
          var enabled = entity.state === 'on';
          
          if (phoneHome && enabled) 
            return 'green';
          else if (enabled)
            return 'orange';
          else
            return 'red';
        ]]]
  card:
    - padding: 12px

# ========================================
# ALTERNATIVE: SIMPLE ENTITIES CARD
# no custom components required
# ========================================
type: entities
title: wake-up Alarm
entities:
  - entity: input_datetime.next_alarm
    name: next Alarm
    icon: mdi:alarm
  - entity: input_boolean.alarm_light_enabled
    name: enable light flash
  - entity: device_tracker.your_phone  # CHANGE THIS
    name: Phone location
  - type: button
    name: Test Light Flash
    icon: mdi:lightbulb-on
    action_name: TEST
    tap_action:
      action: call-service
      service: script.alarm_light_flash

# ========================================
# ALTERNATIVE: COMPACT CARD
# minimal design with essential info
# ========================================
type: custom:button-card
entity: input_datetime.next_alarm
name: Next Alarm
icon: mdi:alarm-clock
show_state: true
show_label: true
label: |
  [[[
    var enabled = states['input_boolean.alarm_light_enabled'].state;
    var phone = states['device_tracker.your_phone'].state;  // CHANGE THIS
    if (enabled === 'on' && phone === 'home') {
      return '‚úì Light will flash';
    } else if (enabled === 'on') {
      return '‚ö† You are away';
    } else {
      return '‚úó Light disabled';
    }
  ]]]
tap_action:
  action: more-info
styles:
  card:
    - height: 80px

# ========================================
# FULL DASHBOARD VIEW
# complete view with all alarm controls
# ========================================
views:
  - title: wake-up Alarm
    icon: mdi:alarm
    cards:
      # status Card
      - type: custom:button-card
        entity: input_boolean.alarm_light_enabled
        name: |
          [[[
            return entity.state === 'on' ? 'Alarm Light is ON' : 'Alarm Light is OFF';
          ]]]
        icon: mdi:alarm-light
        show_state: false
        show_label: true
        label: |
          [[[
            if (states['input_datetime.next_alarm']) {
              return 'Next: ' + states['input_datetime.next_alarm'].state;
            }
            return 'no alarm set';
          ]]]
        tap_action:
          action: toggle
        styles:
          icon:
            - width: 35px
            - color: |
                [[[ 
                  var phone = states['device_tracker.your_phone'];  // CHANGE THIS
                  var phoneHome = phone && phone.state === 'home';
                  var enabled = entity.state === 'on';
                  
                  if (phoneHome && enabled) 
                    return 'green';
                  else if (enabled)
                    return 'orange';
                  else
                    return 'red';
                ]]]
          card:
            - padding: 12px
      
      # details card
      - type: entities
        title: Alarm details
        entities:
          - entity: input_datetime.next_alarm
            name: scheduled time
          - entity: sensor.time_until_alarm
            name: time until Alarm
          - entity: device_tracker.your_phone  # CHANGE THIS
            name: Phone status
          - entity: input_boolean.alarm_light_enabled
            name: Light flash enabled
      
      # test controls
      - type: entities
        title: test controls
        entities:
          - type: button
            name: test light flash
            icon: mdi:lightbulb-on
            action_name: TEST
            tap_action:
              action: call-service
              service: script.alarm_light_flash
          - type: button
            name: stop light flash
            icon: mdi:stop
            action_name: STOP
            tap_action:
              action: call-service
              service: script.turn_off
              service_data:
                entity_id: script.alarm_light_flash
      
      # optional: history graph
      - type: history-graph
        title: Alarm history
        hours_to_show: 168  # 1 week
        entities:
          - entity: input_datetime.next_alarm
          - entity: input_boolean.alarm_light_enabled

# ========================================
# MARKDOWN INFO CARD
# display instructions and status
# ========================================
type: markdown
content: |
  ## üåÖ wake-up light status
  
  {% set alarm = states('input_datetime.next_alarm') %}
  {% set enabled = is_state('input_boolean.alarm_light_enabled', 'on') %}
  {% set phone = is_state('device_tracker.your_phone', 'home') %}  {# CHANGE THIS #}
  
  **next Alarm:** {{ alarm if alarm not in ['unknown', 'unavailable'] else 'not set' }}
  
  **Light Flash:** {{ '‚úÖ enabled' if enabled else '‚ùå disabled' }}
  
  **Phone Status:** {{ 'üè† home' if phone else 'üöó away' }}
  
  ---
  
  {% if enabled and phone %}
  ‚úÖ **all systems ready!** light will flash when alarm triggers.
  {% elif enabled and not phone %}
  ‚ö†Ô∏è **warning:** you're away from home. light will not trigger.
  {% else %}
  ‚ÑπÔ∏è **info:** Alarm light is currently disabled.
  {% endif %}
  
  üí° tap the control button above to toggle on/off.

# ========================================
# GLANCE CARD
# quick overview of all entities
# ========================================
type: glance
title: wake-up overview
entities:
  - entity: input_datetime.next_alarm
    name: next Alarm
  - entity: input_boolean.alarm_light_enabled
    name: enabled
  - entity: device_tracker.your_phone  # CHANGE THIS
    name: phone
  - entity: sensor.time_until_alarm
    name: time left

# ========================================
# PICTURE ELEMENTS CARD
# visual floorplan-style control
# (requires background image)
# ========================================
type: picture-elements
image: /local/bedroom_floorplan.png  # add your own image
elements:
  - type: state-icon
    entity: input_boolean.alarm_light_enabled
    tap_action:
      action: toggle
    style:
      top: 50%
      left: 30%
      transform: scale(2)
  - type: state-label
    entity: input_datetime.next_alarm
    style:
      top: 80%
      left: 50%
      color: white
      font-size: 20px
